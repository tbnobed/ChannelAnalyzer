# Migration container - runs once to set up database schema
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY tsconfig.json ./

# Install ALL dependencies (now includes ts-node in devDependencies)
RUN npm ci

# Copy necessary files for migrations
COPY shared ./shared
COPY drizzle.config.ts ./drizzle.config.ts
COPY db.ts ./db.ts

# Run drizzle-kit directly (it will use ts-node to load the TypeScript config)
CMD ["npx", "drizzle-kit", "push", "--yes"]
